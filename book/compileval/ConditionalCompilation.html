<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Conditional Compilation  - Modern C++ Explained</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../section-lines.css">
        <link rel="stylesheet" href="../version-commit.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Preface</a></li><li class="chapter-item expanded affix "><li class="part-title">Modern C++ Elements</li><li class="chapter-item expanded "><a href="../primitive/index.html">Fundamental Data Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../primitive/IntTypes.html">Integer Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../primitive/IntTypes_longlong.html">Integer Type long long</a></li></ol></li><li class="chapter-item expanded "><a href="../primitive/CharTypes.html">Character Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../primitive/CharTypes_CharSetsEncodings.html">Character Sets and Encodings</a></li><li class="chapter-item expanded "><a href="../primitive/CharTypes_NewCharTypes.html">New Character Types</a></li><li class="chapter-item expanded "><a href="../primitive/CharTypes_StringLiteralCat.html">Automatic String Literal Concatenation</a></li><li class="chapter-item expanded "><a href="../primitive/CharTypes_LibrarySuppor.html">Library Support</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../namespace/index.html">Namespace</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../namespace/InlineNamespace.html">Inline Namespace</a></li><li class="chapter-item expanded "><a href="../namespace/NewNestedNamespaceSyntax.html">New Nested Namespace Syntax</a></li><li class="chapter-item expanded "><a href="../namespace/UnnamedNamespace.html">Unnamed Namespace</a></li><li class="chapter-item expanded "><a href="../namespace/MergedNamespace.html">Merged Namespace</a></li><li class="chapter-item expanded "><a href="../namespace/GlobalNamespace.html">Global Namespace</a></li></ol></li><li class="chapter-item expanded "><a href="../compileval/index.html">Compile Time Evaluation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../compileval/Constexpr.html">constexpr</a></li><li class="chapter-item expanded "><a href="../compileval/NumericLimit.html">std::numeric_limits</a></li><li class="chapter-item expanded "><a href="../compileval/MathFunctions.html">Math functions</a></li><li class="chapter-item expanded "><a href="../compileval/Lambdas.html">Lambdas</a></li><li class="chapter-item expanded "><a href="../compileval/InliningConstExpr.html">Inlining constexpr</a></li><li class="chapter-item expanded "><a href="../compileval/ConditionalCompilation.html" class="active">Conditional Compilation </a></li><li class="chapter-item expanded "><a href="../compileval/VirtualFunctions.html">Virtual Functions</a></li><li class="chapter-item expanded "><a href="../compileval/TryCatch.html">try-catch </a></li><li class="chapter-item expanded "><a href="../compileval/DefaultInit.html">Initialization of constexpr Object</a></li><li class="chapter-item expanded "><a href="../compileval/ConstEvalAndConstInit.html">consteval and constinit</a></li><li class="chapter-item expanded "><a href="../compileval/StdIsConstant.html">std::is_constant_evaluated</a></li><li class="chapter-item expanded "><a href="../compileval/OtherEnhancements.html">Other Enhancements</a></li></ol></li><li class="chapter-item expanded "><a href="../typededuction/index.html">Type Deduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../typededuction/Introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../typededuction/Mechnisms.html">Mechanisms</a></li><li class="chapter-item expanded "><a href="../typededuction/Rules.html">Rules</a></li><li class="chapter-item expanded "><a href="../typededuction/BestPractices.html">Best Practices</a></li></ol></li><li class="chapter-item expanded "><a href="../typequery/index.html">Type Query</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../typequery/Introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../typequery/Mechnisms.html">Mechanisms</a></li><li class="chapter-item expanded "><a href="../typequery/Rules.html">Rules</a></li><li class="chapter-item expanded "><a href="../typequery/BestPractices.html">Best Practices</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Meta-template Programming</li><li class="chapter-item expanded affix "><li class="part-title">Algorithms</li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Modern C++ Explained</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/wxinix/cpp-explained" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="conditional-compilation"><a class="header" href="#conditional-compilation">Conditional Compilation</a></h1>
<h2 id="if-constexpr-and-if"><a class="header" href="#if-constexpr-and-if"><code>if constexpr</code> and <code>#if</code></a></h2>
<p>C++'s <code>if constexpr</code> is not directly intended to replace conditional defines (e.g., <code>#ifdef</code> or <code>#if</code>). While they serve somewhat similar purposes, they have different use cases and operate at different stages of the compilation process.</p>
<p><code>#ifdef</code> and <code>#if</code> are preprocessor directives in C++ that allow conditional compilation. They operate at the preprocessing stage, which occurs before the actual compilation. Conditional defines are typically used to conditionally include or exclude sections of code based on compile-time conditions or macros.</p>
<p>On the other hand, <code>if constexpr</code> is a feature introduced in C++17 that allows compile-time evaluation of conditions within the context of template metaprogramming or constexpr functions. It is part of the regular C++ code and is evaluated during the compilation process, not the preprocessing stage. <code>if constexpr</code> allows you to conditionally choose between different branches of code based on compile-time constant expressions.</p>
<p>Here's an example to illustrate the difference:</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;

#define USE_FEATURE

void doSomething() {
#ifdef USE_FEATURE
    std::cout &lt;&lt; &quot;Feature is enabled.&quot; &lt;&lt; std::endl;
#else
    std::cout &lt;&lt; &quot;Feature is disabled.&quot; &lt;&lt; std::endl;
#endif
}

template &lt;bool UseFeature&gt;
void doSomethingTemplate() {
    if constexpr (UseFeature) {
        std::cout &lt;&lt; &quot;Feature is enabled.&quot; &lt;&lt; std::endl;
    } else {
        std::cout &lt;&lt; &quot;Feature is disabled.&quot; &lt;&lt; std::endl;
    }
}

int main() {
    doSomething();  // Output depends on the USE_FEATURE macro.

    doSomethingTemplate&lt;true&gt;();  // Output depends on the template argument.
    doSomethingTemplate&lt;false&gt;();

    return 0;
}
</code></pre>
<p>In this example, <code>doSomething()</code> uses a conditional define to determine which section of code to compile based on the <code>USE_FEATURE</code> macro. On the other hand, <code>doSomethingTemplate()</code> is a function template that utilizes <code>if constexpr</code> to conditionally choose between different code branches at compile time based on the template argument.</p>
<p>While <code>if constexpr</code> can sometimes be used to achieve similar conditional behavior as conditional defines, their usage and capabilities are different. Conditional defines are more flexible and can be controlled externally via macros or command-line options, while <code>if constexpr</code> operates within the confines of the C++ code and allows compile-time decision making based on template arguments or constexpr conditions.</p>
<h2 id="short-circuit-behavior"><a class="header" href="#short-circuit-behavior">Short-circuit behavior</a></h2>
<p>Unlike regular <code>if</code> statements, where the short-circuit behavior applies to the evaluation of the condition, <code>if constexpr</code> evaluates the condition at compile-time, and all branches are checked for syntactic correctness regardless of the condition's value.</p>
<p>In this example:</p>
<pre><code class="language-cpp">template &lt;typename T&gt;
void foo(T value) {
    if constexpr (std::is_integral_v&lt;T&gt; &amp;&amp; (value &gt; 0)) {
        // Code specific to integral types and positive values
        // ...
    } else {
        // Code for other cases
        // ...
    }
}
</code></pre>
<p>Both <code>std::is_integral_v&lt;T&gt;</code> and <code>(value &gt; 0)</code> will be evaluated during compilation, regardless of the outcome of the condition. This means that any type-dependent or invalid code inside the discarded branch may still lead to compilation errors.</p>
<h2 id="branch-elimination"><a class="header" href="#branch-elimination">Branch elimination</a></h2>
<p>In an <code>if constexpr</code> statement, the condition is evaluated at compile-time. If the condition is determined to be <code>false</code> during compilation, the code inside the branch that is not taken (either <code>if</code> or <code>else</code>) is discarded by the compiler. The discarded branch is not checked for syntactic correctness or compiled.</p>
<p>This compile-time evaluation and branch elimination make <code>if constexpr</code> useful for conditional compilation and optimizing code based on compile-time conditions.</p>
<p>By discarding the unused branch, the compiler avoids checking its syntax and does not generate any corresponding object code. This can help improve the compile time and reduce the size of the resulting binary executable.</p>
<h2 id="always-provide-else-branch"><a class="header" href="#always-provide-else-branch">Always provide <code>else</code> branch</a></h2>
<p>It is generally a good practice to provide an <code>else</code> branch or alternative handling for all possible cases in an <code>if constexpr</code> statement to avoid potential runtime issues and ensure that all scenarios are properly handled.</p>
<pre><code class="language-cpp">template&lt;class T&gt;
auto subtract(T a, T b) {
    if constexpr (std::is_same&lt;T, double&gt;::value) {
        if (std::abs(a - b) &lt; 0.0001) {
            return 0.0;
        } else {
            return a - b;
        }
    } else if constexpr (std::is_integral&lt;T&gt;::value) {
        return a - b;
    } else {
        static_assert(always_false&lt;T&gt;::value, &quot;Non-handled type for subtract function&quot;);
    }
}
</code></pre>
<p>In this code, both double and integral types are explicitly handled. If a type is used that is neither double nor an integral type, the static_assert will trigger a compile-time error with a clear message, which is generally preferable to a more obscure error about invalid operations. This is a more defensive programming strategy that makes sure all potential types are handled.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../compileval/InliningConstExpr.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../compileval/VirtualFunctions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../compileval/InliningConstExpr.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../compileval/VirtualFunctions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
